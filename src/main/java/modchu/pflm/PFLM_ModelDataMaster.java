package modchu.pflm;import java.awt.Color;import java.awt.image.BufferedImage;import java.io.IOException;import java.net.URL;import java.util.Random;import javax.imageio.ImageIO;import modchu.lib.Modchu_AS;import modchu.lib.Modchu_CastHelper;import modchu.lib.Modchu_Debug;import modchu.lib.Modchu_EntityCapsHelper;import modchu.lib.Modchu_IEntityCapsBase;import modchu.lib.Modchu_Main;import modchu.lib.Modchu_Reflect;import modchu.lib.Modchu_RenderEngine;import modchu.model.ModchuModel_IEntityCaps;import modchu.model.ModchuModel_ModelDataBase;import modchu.model.ModchuModel_ModelDataMaster;import modchu.model.ModchuModel_TextureManagerBase;public class PFLM_ModelDataMaster extends ModchuModel_ModelDataMaster {	public boolean initResetFlag = false;	public Random rnd = new Random();	public boolean sendIDAllFlag = true;	public PFLM_ModelDataMaster() {		super();	}	@Override	public ModchuModel_ModelDataBase getPlayerData(Object entity) {		if (entityCheck(entity)); else return super.getPlayerData(entity);		if (entity != null); else {			Modchu_Debug.lDebug("PFLM_ModelDataMaster getPlayerData entity == null !! return.");			return null;		}		ModchuModel_ModelDataBase data = super.getPlayerData(entity);		if (data != null); else return null;		if (data.getCapsValueBoolean(data.caps_isPlayer)) {			entity = Modchu_Reflect.invokeMethod(data.getClass(), "getCapsValue", new Class[]{ int.class, Object[].class }, data, new Object[]{ Modchu_IEntityCapsBase.caps_Entity, null }, -1);			if (entity != null) {				Object thePlayer = Modchu_AS.get(Modchu_AS.minecraftThePlayer);				if (!thePlayer.equals(entity)) Modchu_Reflect.setFieldObject(ModchuModel_ModelDataBase.class, "owner", data, thePlayer);			}		}		return data;	}	@Override	public ModchuModel_ModelDataBase newPlayerData(Object entity) {		if (!loadCheck()				| !entityCheck(entity)) return null;		PFLM_ModelData modelData = (PFLM_ModelData) newPlayerDataDefaultSetting(entity, new PFLM_ModelData());		return newPlayerData(entity, modelData);	}	@Override	public ModchuModel_ModelDataBase newPlayerData(Object entity, ModchuModel_ModelDataBase data) {		//Modchu_Debug.mDebug("PFLM_ModelDataMaster newPlayerData entity="+entity);		if (entity != null				&& loadCheck()); else {			Modchu_Debug.Debug("PFLM_ModelDataMaster newPlayerData return null !! entity="+entity);			Modchu_Debug.Debug("PFLM_ModelDataMaster newPlayerData return null !! loadCheck()="+loadCheck());			return null;		}		if (!entityCheck(entity)				| (!entityPlayerCheck(entity)						&& !entityPlayerDummyCheck(entity))) {			return super.newPlayerData(entity, !(data instanceof PFLM_ModelData) ? data : null);		}		PFLM_ModelData modelData = null;		if (data != null && !(data instanceof PFLM_ModelData)) return null;		modelData = (PFLM_ModelData) data;		if (modelData != null); else modelData = (PFLM_ModelData) newPlayerDataDefaultSetting(entity, new PFLM_ModelData());		Modchu_Debug.lDebug("PFLM_ModelDataMaster newPlayerData start --------");		boolean isPlayer = isPlayerCheck(modelData, entity);		if (!isPlayer				&& entityPlayerCheck(entity)				&& !entityPlayerDummyCheck(entity)) {			// OtherPlayer			if (otherPlayerLoadPlayerData(entity, modelData)) {				Modchu_Debug.lDebug("PFLM_ModelDataMaster newPlayerData otherPlayer end. --------");				return checkModelData(modelData);			}		} else {			Object thePlayer = Modchu_AS.get(Modchu_AS.minecraftThePlayer);			if (sendIDAllFlag) {				PFLM_PacketPlayerStateManager.addSendList(PFLM_Main.getPFLMFPacketConstant("packet_IDAll"), modelData, thePlayer);				sendIDAllFlag = false;			}			modelData.setCapsValue(modelData.caps_dominantArm, playerHandednessSetting());			PFLM_PacketPlayerStateManager.addSendList((byte) 0, modelData, thePlayer);			// Player Skin Random Mode			if (PFLM_GuiConstant.getSkinMode(PFLM_ConfigData.changeMode) == ModchuModel_IEntityCaps.skinMode_Random) {				Modchu_Debug.lDebug("PFLM_ModelDataMaster newPlayerData Random end. --------");				return newPlayerDataRandom(entity, modelData);			}		}		// Player Skin Offline Mode		if ((isPlayer				&& PFLM_GuiConstant.getSkinMode(PFLM_ConfigData.changeMode) == ModchuModel_IEntityCaps.skinMode_offline)				| (isSkinModeOffline(modelData.getCapsValueInt(modelData.caps_skinMode))				&& !(isPlayer				&& PFLM_GuiConstant.getSkinMode(PFLM_ConfigData.changeMode) == ModchuModel_IEntityCaps.skinMode_online))) {			Modchu_Debug.lDebug("PFLM_ModelDataMaster newPlayerData Offline isPlayer="+isPlayer);			Modchu_Debug.lDebug("PFLM_ModelDataMaster newPlayerData Offline skinMode="+getSkinModeString(modelData.getCapsValueInt(modelData.caps_skinMode)));			Modchu_Debug.lDebug("PFLM_ModelDataMaster newPlayerData Offline end. --------");			return newPlayerDataOffline(entity, modelData);		}		if ((isPlayer				&& PFLM_GuiConstant.getSkinMode(PFLM_ConfigData.changeMode) == ModchuModel_IEntityCaps.skinMode_online)			| isSkinModeOnline(modelData.getCapsValueInt(modelData.caps_skinMode))) {			// OtherPlayer and Player Skin Online Mode			modelData = (PFLM_ModelData) newPlayerDataOnline(entity, modelData);		}		Modchu_Debug.lDebug("PFLM_ModelDataMaster newPlayerData Online end. --------");		return checkModelData(modelData);	}	private ModchuModel_ModelDataBase newPlayerDataOnline(Object entity, PFLM_ModelData modelData) {		String userName = getUserName(modelData, entity);		String debugS = userName+" : "+"newPlayerDataOnline ";		Modchu_Debug.lDebug(debugS);		BufferedImage bufferedimage = getOnlineSkin(modelData, entity);		//Modchu_Debug.mDebug("newPlayerDataOnline 1");		modelData.setCapsValue(modelData.caps_initFlag, 2);		Modchu_Debug.mDebug("newPlayerDataOnline bufferedimage="+bufferedimage);		boolean isPlayer = isPlayerCheck(modelData, entity);		if (bufferedimage != null) {			//Modchu_Debug.mlDebug(""+entity.userName+" : "+"OnlineMode bufferedimage != null ?"+(bufferedimage != null));			textureBipedDefaultSetting(modelData, bufferedimage.getWidth() == bufferedimage.getHeight());			if (isPlayer) {				if (PFLM_GuiConstant.getSkinMode(PFLM_ConfigData.changeMode) == ModchuModel_IEntityCaps.skinMode_online) {					modelData.setCapsValue(modelData.caps_skinMode, ModchuModel_IEntityCaps.skinMode_online);					Modchu_Debug.lDebug(debugS+"newPlayerDataOnline bufferedimage != null isPlayer skinMode_online set.");				}				if (!userName.startsWith("Player")						&& !userName.startsWith("User_")						&& modelData.getCapsValueInt(modelData.caps_initFlag) == 0						&& !initResetFlag) {					modelData.setCapsValue(modelData.caps_initFlag, 1);					modelData.setCapsValue(modelData.caps_freeVariable, "skinChar", true);					initResetFlag = true;					resetFlag = true;					Modchu_Debug.lDebug(debugS + "caps_initFlag return");					return modelData;				}			} else {				modelData.setCapsValue(modelData.caps_initFlag, 2);			}			modelData.setCapsValue(modelData.caps_freeVariable, "skinChar", false);			Modchu_Debug.mDebug("newPlayerDataOnline 2 set bufferedimage != null skinChar false");		} else {			Modchu_Debug.lDebug(debugS + "bufferedimage == null");			if (isPlayer) Modchu_Debug.lDebug(debugS + "GuiChangeMode="+PFLM_GuiConstant.getSkinMode(PFLM_ConfigData.changeMode));			//Modchu_Debug.mDebug(""+entity.userName+" : "+"er entity.skinUrl = "+entity.skinUrl);			int skinMode = modelData.getCapsValueInt(modelData.caps_skinMode);			Modchu_Debug.lDebug(debugS + "skinMode="+getSkinModeString(skinMode));			if (isPlayer) {				if (skinMode == ModchuModel_IEntityCaps.skinMode_PlayerOnline						| skinMode == ModchuModel_IEntityCaps.skinMode_online) {					modelData.setCapsValue(modelData.caps_freeVariable, "skinChar", true);					Modchu_Debug.lDebug(debugS + "isPlayer skinMode_char set 3");				} else {					Modchu_Debug.lDebug(debugS + "isPlayer skinMode_char no set");				}			} else {				if (skinMode == ModchuModel_IEntityCaps.skinMode_Player) {					PFLM_ModelData modelData2 = (PFLM_ModelData) getPlayerData(Modchu_AS.get(Modchu_AS.minecraftThePlayer));					if (modelData2 != null) {						if (modelData2.getCapsValueBoolean(modelData.caps_freeVariable, "skinChar")) {							modelData2.setCapsValue(modelData.caps_freeVariable, "skinChar", true);							Modchu_Debug.lDebug(debugS + "!isPlayer skinMode_char set 4");						}					}				} else if (skinMode == ModchuModel_IEntityCaps.skinMode_PlayerOnline						| skinMode == ModchuModel_IEntityCaps.skinMode_online) {					modelData.setCapsValue(modelData.caps_freeVariable, "skinChar", true);					Modchu_Debug.lDebug(debugS + "!isPlayer skinMode_char set 5");				} else {					Modchu_Debug.lDebug(debugS + "!isPlayer skinMode_char no set");				}				modelData.setCapsValue(modelData.caps_initFlag, 2);			}			if (modelData.getCapsValueBoolean(modelData.caps_freeVariable, "skinChar")) {				textureBipedDefaultSetting(modelData, getNewOnlineSkinFlag(modelData));				modelInit(entity, modelData, Modchu_CastHelper.String(modelData.getCapsValue(modelData.caps_textureName)));				modelArmorInit(entity, modelData, Modchu_CastHelper.String(modelData.getCapsValue(modelData.caps_textureArmorName)));				modelData.setCapsValue(modelData.caps_initFlag, 2);				return checkModelData(modelData);			}		}		Modchu_Debug.lDebug(debugS + "skinMode="+getSkinModeString(modelData.getCapsValueInt(modelData.caps_skinMode)));		return checkSkin(entity, bufferedimage, modelData);	}	private ModchuModel_ModelDataBase newPlayerDataOffline(Object entity, PFLM_ModelData modelData) {		String userName = getUserName(modelData, entity);		Modchu_Debug.lDebug(""+userName+" : "+"checkSkin skinMode_offline");		if (PFLM_ConfigData.textureName != null				&& PFLM_ConfigData.textureName.equals("_Biped")) {			PFLM_ConfigData.textureName = PFLM_ConfigData.textureArmorName = ModchuModel_TextureManagerBase.instance.getDefaultTextureName();		}		modelData.setCapsValue(modelData.caps_maidColor, PFLM_ConfigData.maidColor);		modelData.setCapsValue(modelData.caps_skinMode, ModchuModel_IEntityCaps.skinMode_offline);		modelData.setCapsValue(modelData.caps_textureName, PFLM_ConfigData.textureName);		modelData.setCapsValue(modelData.caps_textureArmorName, PFLM_ConfigData.textureArmorName);		modelInit(entity, modelData, Modchu_CastHelper.String(modelData.getCapsValue(modelData.caps_textureName)));		modelArmorInit(entity, modelData, Modchu_CastHelper.String(modelData.getCapsValue(modelData.caps_textureArmorName)));		modelData.setCapsValue(modelData.caps_freeVariable, "skinChar", false);		modelData.setCapsValue(modelData.caps_initFlag, 2);		return checkModelData(modelData);	}	private ModchuModel_ModelDataBase newPlayerDataRandom(Object entity, PFLM_ModelData modelData) {		String userName = getUserName(modelData, entity);		Modchu_Debug.lDebug(""+userName + " : "+"newPlayerData Player Random setting.");		skinMode_RandomSetting(entity, modelData);		modelData.setCapsValue(modelData.caps_freeVariable, "skinChar", false);		modelData.setCapsValue(modelData.caps_initFlag, 2);		return checkModelData(modelData);	}	private boolean otherPlayerLoadPlayerData(Object entity, PFLM_ModelData modelData) {		String userName = getUserName(modelData, entity);		String t[] = PFLM_Main.playerLocalData != null				&& !PFLM_Main.playerLocalData.isEmpty()				&& userName != null				&& PFLM_Main.playerLocalData.containsKey(userName) ? Modchu_CastHelper.StringArray(PFLM_Main.playerLocalData.get(userName)) : null;		PFLM_ModelData modelData2;		if (t != null) {			int skinMode = Modchu_CastHelper.Int(t[4]);			switch (skinMode) {			case ModchuModel_IEntityCaps.skinMode_Player:				Modchu_Debug.lDebug(""+userName + " : "+"otherPlayerLoadPlayerData Individual modePlayer");				skinMode_PlayerSetting(entity, modelData);				break;			case ModchuModel_IEntityCaps.skinMode_offline:				Modchu_Debug.lDebug(""+userName + " : "+"otherPlayerLoadPlayerData Individual modeOthersSettingOffline");				modelData.setCapsValue(modelData.caps_skinMode, ModchuModel_IEntityCaps.skinMode_OthersIndividualSettingOffline);				String s2 = t[0];				modelData.setCapsValue(modelData.caps_maidColor, Modchu_CastHelper.Int(t[2]));				setResourceLocation(modelData, entity, 0, ModchuModel_TextureManagerBase.instance.textureManagerGetTexture(s2, modelData.getCapsValueInt(modelData.caps_maidColor)));				setResourceLocation(modelData, entity, 0, ModchuModel_TextureManagerBase.instance.textureManagerGetTexture(s2, modelData.getCapsValueInt(modelData.caps_maidColor)));				modelInit(entity, modelData, s2);				s2 = t[1];				modelData.setCapsValue(modelData.caps_textureName, s2);				modelData.setCapsValue(modelData.caps_textureArmorName, t[1]);				modelArmorInit(entity, modelData, s2);				modelData.setCapsValue(modelData.caps_dominantArm, Modchu_Main.integerCheck(t[5]) ? othersPlayerIndividualHandednessSetting(Modchu_CastHelper.Int(t[5])) : 0);				modelData.setCapsValue(modelData.caps_modelScale, Modchu_Main.floatCheck(t[3]) ? Modchu_CastHelper.Float(t[3]) : 0.0F);				break;			case ModchuModel_IEntityCaps.skinMode_PlayerOffline:				Modchu_Debug.lDebug(""+userName + " : "+"otherPlayerLoadPlayerData Individual modePlayerOffline");				skinMode_PlayerOfflineSetting(entity, modelData);				break;			case ModchuModel_IEntityCaps.skinMode_PlayerOnline:				Modchu_Debug.lDebug(""+userName + " : "+"otherPlayerLoadPlayerData Individual modePlayerOnline");				skinMode_PlayerOnlineSetting(entity, modelData);				break;			case ModchuModel_IEntityCaps.skinMode_Random:				Modchu_Debug.lDebug(""+userName + " : "+"otherPlayerLoadPlayerData Individual modeRandom");				skinMode_RandomSetting(entity, modelData);				modelData.setCapsValue(modelData.caps_dominantArm, Modchu_Main.integerCheck(t[5]) ? othersPlayerIndividualHandednessSetting(Modchu_CastHelper.Int(t[5])) : 0);				modelData.setCapsValue(modelData.caps_modelScale, Modchu_CastHelper.Float(t[3]));				break;			case ModchuModel_IEntityCaps.skinMode_online:				Modchu_Debug.lDebug(""+userName + " : "+"otherPlayerLoadPlayerData Individual modefalse");				skinMode_FalseSetting(entity, modelData);				break;			}			modelData.setCapsValue(modelData.caps_initFlag, 2);			if (skinMode != ModchuModel_IEntityCaps.skinMode_PlayerOnline					&& skinMode != ModchuModel_IEntityCaps.skinMode_online					&& !(skinMode == ModchuModel_IEntityCaps.skinMode_Player					&& PFLM_GuiConstant.getSkinMode(PFLM_ConfigData.changeMode) == ModchuModel_IEntityCaps.skinMode_online)) {				Modchu_Debug.lDebug(""+userName + " : "+"otherPlayerLoadPlayerData Individual !Player skinMode != Online return. skinMode="+(getSkinModeString(skinMode)));				return true;			}		} else {			switch (PFLM_GuiConstant.getOtherSkinMode(PFLM_ConfigData.othersChangeMode)) {			case ModchuModel_IEntityCaps.skinMode_Player:				Modchu_Debug.lDebug(""+userName + " : "+"otherPlayerLoadPlayerData OthersSetting modePlayer");				skinMode_PlayerSetting(entity, modelData);				break;			case ModchuModel_IEntityCaps.skinMode_offline:				Modchu_Debug.lDebug(""+userName + " : "+"otherPlayerLoadPlayerData OthersSetting modeOthersSettingOffline");				modelData.setCapsValue(modelData.caps_skinMode, ModchuModel_IEntityCaps.skinMode_OthersSettingOffline);				String s = PFLM_ConfigData.othersTextureName;				modelData.setCapsValue(modelData.caps_maidColor, PFLM_ConfigData.othersMaidColor);				modelInit(entity, modelData, s);				s = PFLM_ConfigData.othersTextureArmorName;				modelData.setCapsValue(modelData.caps_textureName, PFLM_ConfigData.othersTextureName);				modelData.setCapsValue(modelData.caps_textureArmorName, PFLM_ConfigData.othersTextureArmorName);				modelArmorInit(entity, modelData, s);				modelData.setCapsValue(modelData.caps_dominantArm, othersPlayerHandednessSetting());				modelData.setCapsValue(modelData.caps_modelScale, PFLM_ConfigData.othersModelScale);				//Modchu_Debug.mDebug(""+entityplayer.userName+" : "+"modelData handedness="+modelData.getCapsValueInt(modelData.caps_dominantArm));				break;			case ModchuModel_IEntityCaps.skinMode_PlayerOffline:				Modchu_Debug.lDebug(""+userName + " : "+"otherPlayerLoadPlayerData OthersSetting modePlayerOffline");				skinMode_PlayerOfflineSetting(entity, modelData);				break;			case ModchuModel_IEntityCaps.skinMode_PlayerOnline:				Modchu_Debug.lDebug(""+userName + " : "+"otherPlayerLoadPlayerData OthersSetting modePlayerOnline");				skinMode_PlayerOnlineSetting(entity, modelData);				break;			case ModchuModel_IEntityCaps.skinMode_Random:				Modchu_Debug.lDebug(""+userName + " : "+"otherPlayerLoadPlayerData OthersSetting modeRandom");				skinMode_RandomSetting(entity, modelData);				modelData.setCapsValue(modelData.caps_dominantArm, othersPlayerHandednessSetting());				modelData.setCapsValue(modelData.caps_modelScale, PFLM_ConfigData.othersModelScale);				break;			case ModchuModel_IEntityCaps.skinMode_online:				Modchu_Debug.lDebug(""+userName + " : "+"otherPlayerLoadPlayerData OthersSetting modefalse");				skinMode_FalseSetting(entity, modelData);				break;			}			int skinMode = modelData.getCapsValueInt(modelData.caps_skinMode);			if (skinMode != ModchuModel_IEntityCaps.skinMode_PlayerOnline					&& skinMode != ModchuModel_IEntityCaps.skinMode_online					&& !(skinMode == ModchuModel_IEntityCaps.skinMode_Player					&& PFLM_GuiConstant.getSkinMode(PFLM_ConfigData.changeMode) == ModchuModel_IEntityCaps.skinMode_online)) {				modelData.setCapsValue(modelData.caps_initFlag, 2);				Modchu_Debug.lDebug(""+userName + " : "+"otherPlayerLoadPlayerData !Player skinMode != Online return. skinMode="+(getSkinModeString(skinMode))+" PFLM_ConfigData.othersChangeMode="+PFLM_ConfigData.othersChangeMode);				return true;			}		}		return false;	}	@Override	public ModchuModel_ModelDataBase newPlayerDataDefaultSetting(Object entity, ModchuModel_ModelDataBase data) {		super.newPlayerDataDefaultSetting(entity, data);		if (!(data instanceof PFLM_ModelData)) return data;		Modchu_Debug.mDebug("PFLM_ModelDataMaster newPlayerDataDefaultSetting entity="+entity);		data.setCapsValue(data.caps_skinMode, ModchuModel_IEntityCaps.skinMode_offline);		data.setCapsValue(data.caps_EntityType, data.entityType_PFLM);		data.setCapsValue(data.caps_freeVariable, "skinChar", false);		Modchu_Debug.mDebug("PFLM_ModelDataMaster newPlayerDataDefaultSetting 1 set skinChar false");		if (entityPlayerCheck(entity)) data.setCapsValue(data.caps_freeVariable, "showArmor", true);		Modchu_Reflect.setFieldObject(ModchuModel_ModelDataBase.class, "owner", data, entity);		//((PFLM_ModelData) data).modelMain.setEntityCaps(data);		String userName = getUserName(data, entity);		Modchu_Debug.mDebug("PFLM_ModelDataMaster newPlayerDataDefaultSetting userName="+userName);		Object thePlayer = Modchu_AS.get(Modchu_AS.minecraftThePlayer);		if (thePlayer != null); else return data;		Modchu_Debug.mDebug("PFLM_ModelDataMaster newPlayerDataDefaultSetting thePlayer userName="+getUserName(data, thePlayer));		boolean isPlayer = userName != null ? userName == getUserName(data, thePlayer) : false;		data.setCapsValue(data.caps_isPlayer, isPlayer);		if (isPlayer) {			data.setCapsValue(data.caps_textureName, PFLM_ConfigData.textureName);			data.setCapsValue(data.caps_textureArmorName, PFLM_ConfigData.textureArmorName);			data.setCapsValue(data.caps_maidColor, PFLM_ConfigData.maidColor);		}		data.setCapsValue(data.caps_tempLimbSwing, Modchu_AS.getFloat(Modchu_AS.entityLivingBaseLimbSwing, entity));		return data;	}	private boolean loadCheck() {		return Modchu_Main.initModsLoaded &&				PFLM_Main.initModsLoaded;	}	@Override	public void modelInit(Object entity, ModchuModel_ModelDataBase modelData, String s, boolean debug, boolean errorDefault) {		super.modelInit(entity, modelData, s, debug, errorDefault);		if (isPlayerCheck(modelData, entity)) {			Modchu_Debug.mDebug("PFLM_ModelDataMaster modelInit isPlayerCheck");			PFLM_ConfigData.textureName = Modchu_CastHelper.String(modelData.getCapsValue(modelData.caps_textureName));		}	}	@Override	public void modelTextureReset(Object entity, ModchuModel_ModelDataBase modelData, String s) {		boolean debug = false;		if (debug) Modchu_Debug.mDebug("modelTextureReset s="+s+" entity="+entity);		Object o = null;		int version = Modchu_Main.getMinecraftVersion();		int skinMode = modelData.getCapsValueInt(modelData.caps_skinMode);		Class AbstractClientPlayer = Modchu_Reflect.loadClass("AbstractClientPlayer");		//Modchu_Debug.lDebug1("ModchuModel_ModelDataMaster modelTextureReset AbstractClientPlayer="+AbstractClientPlayer);		//Modchu_Debug.lDebug1("ModchuModel_ModelDataMaster modelTextureReset containsKey="+Modchu_Reflect.classNameMap.containsKey("AbstractClientPlayer"));		//Modchu_Debug.lDebug1("ModchuModel_ModelDataMaster modelTextureReset classNameMap.get="+Modchu_Reflect.classNameMap.get("AbstractClientPlayer"));		String userName = getUserName(modelData, entity);		if (skinMode == ModchuModel_IEntityCaps.skinMode_online				&& !modelData.getCapsValueBoolean(modelData.caps_localFlag)) {			if (debug) Modchu_Debug.mDebug("modelTextureReset skinMode_online && localFlag return.");			return;		}		if (debug) {			Modchu_Debug.mDebug("modelTextureReset skinMode="+(getSkinModeString(skinMode)));			Modchu_Debug.mDebug("modelTextureReset localFlag="+(modelData.getCapsValueBoolean(modelData.caps_localFlag)));		}		if (modelData.getCapsValueBoolean(modelData.caps_freeVariable, "skinChar")) {			o = steveTexture;		} else if (AbstractClientPlayer.isInstance(entity)				&& (version > 159						&& (isPlayerCheck(modelData, entity)								&& PFLM_GuiConstant.getSkinMode(PFLM_ConfigData.changeMode) == ModchuModel_IEntityCaps.skinMode_online)								&& skinMode != ModchuModel_IEntityCaps.skinMode_local)								| (!isPlayerCheck(modelData, entity)										&& (skinMode == ModchuModel_IEntityCaps.skinMode_online										| skinMode == ModchuModel_IEntityCaps.skinMode_PlayerOnline										| (skinMode == ModchuModel_IEntityCaps.skinMode_Player										&& PFLM_GuiConstant.getSkinMode(PFLM_ConfigData.changeMode) == ModchuModel_IEntityCaps.skinMode_online)))) {			Object thePlayer = Modchu_AS.get(Modchu_AS.minecraftThePlayer);			o = Modchu_Reflect.invokeMethod(AbstractClientPlayer, "func_110311_f", "getLocationSkin", new Class[]{ String.class }, skinMode == ModchuModel_IEntityCaps.skinMode_PlayerOnline					| skinMode == ModchuModel_IEntityCaps.skinMode_Player ? thePlayer : entity, new Object[]{ userName });			if (!isPlayerCheck(modelData, entity)					&& (skinMode == ModchuModel_IEntityCaps.skinMode_online					| skinMode == ModchuModel_IEntityCaps.skinMode_PlayerOnline					| (skinMode == ModchuModel_IEntityCaps.skinMode_Player					&& PFLM_GuiConstant.getSkinMode(PFLM_ConfigData.changeMode) == ModchuModel_IEntityCaps.skinMode_online))) {				o = Modchu_Reflect.invokeMethod(AbstractClientPlayer, "func_110306_p", "getLocationSkin", skinMode == ModchuModel_IEntityCaps.skinMode_PlayerOnline						| skinMode == ModchuModel_IEntityCaps.skinMode_Player ? thePlayer : entity);			}			if (debug) Modchu_Debug.lDebug(""+userName + " : "+"modelTextureReset o="+o + " skinMode="+getSkinModeString(skinMode));		} else {			o = ModchuModel_TextureManagerBase.instance.textureManagerGetTexture(s, modelData.getCapsValueInt(modelData.caps_maidColor));			if (debug) {				Modchu_Debug.lDebug("modelTextureReset else o="+o);				Modchu_Debug.lDebug("modelTextureReset else skinMode="+getSkinModeString(skinMode));				Modchu_Debug.lDebug("modelTextureReset else entity.getClass()="+entity.getClass());				Modchu_Debug.lDebug("modelTextureReset else s="+s+" maidColor="+modelData.getCapsValueInt(modelData.caps_maidColor));			//Modchu_Debug.mDebug(""+userName+" : "+"modelTextureReset entity == thePlayer ?"+(entity == thePlayer));			}		}		if (debug) Modchu_Debug.mDebug("modelTextureReset end o="+o);		setResourceLocation(modelData, entity, 0, o);	}	@Override	public String textureNameDefaultSetting(String s, ModchuModel_ModelDataBase modelData, Object entity, boolean errorDefault) {		if (errorDefault) {			s = ModchuModel_TextureManagerBase.instance.textureNameCheck(null);			if (isPlayerCheck(modelData, entity)					&& Modchu_AS.get(Modchu_AS.minecraftThePlayer) == entity) PFLM_ConfigData.textureName = s;			modelData.setCapsValue(modelData.caps_textureName, s);		} else {			modelData.setCapsValue(modelData.caps_freeVariable, "defaultModelFlag", true);		}		return s;	}	@Override	public String textureArmorNameDefaultSetting(ModchuModel_ModelDataBase modelData, Object entity) {		String s = ModchuModel_TextureManagerBase.instance.textureNameCheck(null);		if (isPlayerCheck(modelData, entity)				&& Modchu_AS.get(Modchu_AS.minecraftThePlayer) == entity) PFLM_ConfigData.textureArmorName = s;		modelData.setCapsValue(modelData.caps_textureArmorName, s);		return s;	}	public BufferedImage getOnlineSkin(PFLM_ModelData modelData, Object entity) {		if (modelData != null); else return null;		Object thePlayer = Modchu_AS.get(Modchu_AS.minecraftThePlayer);;		BufferedImage bufferedimage = null;		int skinMode = modelData.getCapsValueInt(modelData.caps_skinMode);		boolean isPlayer = isPlayerCheck(modelData, entity);		String userName = getUserName(modelData, entity);		if ((isPlayer				&& PFLM_GuiConstant.getSkinMode(PFLM_ConfigData.changeMode) == ModchuModel_IEntityCaps.skinMode_online)				| (!isPlayer						&& (skinMode == ModchuModel_IEntityCaps.skinMode_online						| skinMode == ModchuModel_IEntityCaps.skinMode_PlayerOnline						| (skinMode == ModchuModel_IEntityCaps.skinMode_Player						&& PFLM_GuiConstant.getSkinMode(PFLM_ConfigData.changeMode) == ModchuModel_IEntityCaps.skinMode_online)))) {			if (skinMode == ModchuModel_IEntityCaps.skinMode_offline) modelData.setCapsValue(modelData.caps_skinMode, ModchuModel_IEntityCaps.skinMode_online);			Modchu_Debug.lDebug(""+userName + " : "+"new model read userName = "+userName);			String skinUrl = getSkinUrl(modelData, entity);			Modchu_Debug.mlDebug(""+userName + " : "+"getOnlineSkin OnlineMode skinUrl="+skinUrl);			if (skinUrl != null					&& !skinUrl.isEmpty()) {				try {					URL url = new URL(skinUrl);					bufferedimage = ImageIO.read(url);					Modchu_Debug.mlDebug(""+userName + " : "+"getOnlineSkin OnlineMode.image ok.");				} catch (IOException ioexception) {					StringBuilder s1 = (new StringBuilder()).append("Failed to read a player texture from a URL for ").append(skinUrl);					Modchu_Debug.lDebug(s1.toString());					if (ioexception != null) {						Modchu_Debug.mlDebug("");						Modchu_Debug.mlDebug(ioexception.getMessage());					}				}			} else {				Modchu_Debug.lDebug(""+userName + " : "+"getOnlineSkin OnlineMode skinUrl == null !!");				Modchu_Debug.lDebug(""+userName + " : "+"getOnlineSkin skinMode="+getSkinModeString(skinMode));			}		} else {			Modchu_Debug.lDebug(""+userName + " : "+"getOnlineSkin else isPlayer="+isPlayer);			if (isPlayer) Modchu_Debug.lDebug(""+userName + " : "+"getOnlineSkin else changeMode="+PFLM_GuiConstant.getChangeModeString(PFLM_ConfigData.changeMode));			Modchu_Debug.lDebug(""+userName + " : "+"getOnlineSkin else skinMode="+getSkinModeString(skinMode));		}		return bufferedimage;	}	public String getSkinUrl(PFLM_ModelData modelData, Object entity) {		int skinMode = modelData.getCapsValueInt(modelData.caps_skinMode);		//Modchu_Debug.mDebug("getSkinUrl skinMode="+(getSkinModeString(skinMode)));		if (skinMode == ModchuModel_IEntityCaps.skinMode_online				| skinMode == ModchuModel_IEntityCaps.skinMode_PlayerOnline				| (skinMode == ModchuModel_IEntityCaps.skinMode_Player				&& PFLM_GuiConstant.getSkinMode(PFLM_ConfigData.changeMode) == ModchuModel_IEntityCaps.skinMode_online));		else return null;		Class AbstractClientPlayer = Modchu_Reflect.loadClass("AbstractClientPlayer");		Object thePlayer = Modchu_AS.get(Modchu_AS.minecraftThePlayer);		String userName = getUserName(modelData, entity);		if (userName != null				 && !userName.isEmpty()); else return null;		return Modchu_CastHelper.String(Modchu_Main.getMinecraftVersion() < 179				&& Modchu_Main.getMinecraftVersion() > 159 ? Modchu_Reflect.invokeMethod(AbstractClientPlayer, "func_110300_d", "getSkinUrl", new Class[]{ String.class }, entity, new Object[]{ userName }) :					(new StringBuilder()).append("http://skins.minecraft.net/MinecraftSkins/").append(userName).append(".png").toString());	}	@Override	public String getUserName(ModchuModel_ModelDataBase modelData, Object entity) {		int skinMode = modelData.getCapsValueInt(modelData.caps_skinMode);		Object thePlayer = Modchu_AS.get(Modchu_AS.minecraftThePlayer);		String userName = Modchu_AS.getString(Modchu_AS.userName, entity);		if (Modchu_Debug.debugPlayerName != null) {			userName = isPlayerCheck(modelData, entity) ? Modchu_Debug.debugPlayerName : skinMode == ModchuModel_IEntityCaps.skinMode_PlayerOnline					| (skinMode == ModchuModel_IEntityCaps.skinMode_Player					&& PFLM_GuiConstant.getSkinMode(PFLM_ConfigData.changeMode) == ModchuModel_IEntityCaps.skinMode_online) ? Modchu_Debug.debugPlayerName : userName;		} else {			Object o = modelData.getCapsValue(modelData.caps_freeVariable, "userName");			userName = o != null ? Modchu_CastHelper.String(o) : skinMode == ModchuModel_IEntityCaps.skinMode_PlayerOnline					| (skinMode == ModchuModel_IEntityCaps.skinMode_Player					&& PFLM_GuiConstant.getSkinMode(PFLM_ConfigData.changeMode) == ModchuModel_IEntityCaps.skinMode_online) ? Modchu_AS.getString(Modchu_AS.userName, thePlayer) : userName;			if (userName != null					| entityPlayerCheck(entity)); else userName = Modchu_AS.getString(Modchu_AS.userName, thePlayer);		}		//Modchu_Debug.mDebug("PFLM_ModelDataMaster getUserName userName="+userName);		return userName;	}	public int playerHandednessSetting() {		return PFLM_ConfigData.handednessMode == -1 ? rnd.nextInt(2) : PFLM_ConfigData.handednessMode;	}	public int othersPlayerHandednessSetting() {		return PFLM_ConfigData.othersHandednessMode == -1 ? rnd.nextInt(2) : PFLM_ConfigData.othersHandednessMode;	}	public int othersPlayerIndividualHandednessSetting(int i) {		return i == -1 ? rnd.nextInt(2) : i;	}	public PFLM_ModelData checkSkin(Object entity, BufferedImage bufferedimage, PFLM_ModelData modelData) {		String userName = Modchu_AS.getString(Modchu_AS.userName, entity);		if (bufferedimage == null) {			Modchu_Debug.lDebug(""+userName + " : "+"checkSkin bufferedimage == null");			String s = modelData.getCapsValueBoolean(modelData.caps_freeVariable, "skinChar")					&& getNewOnlineSkinFlag(modelData) ? "_Player" :"_Biped";			modelInit(entity, modelData, s);			modelArmorInit(entity, modelData, s);			modelData.setCapsValue(modelData.caps_initFlag, 2);			return (PFLM_ModelData) checkModelData(modelData);		}		modelData.setCapsValue(modelData.caps_freeVariable, "bufferedimage", bufferedimage);		modelData.setCapsValue(modelData.caps_isActivated, true);		Object[] s = checkimage(bufferedimage);		boolean localflag = (Boolean) s[0];		boolean returnflag = (Boolean) s[5];		if (!returnflag) modelData.setCapsValue(modelData.caps_textureArmorName, Modchu_CastHelper.String(s[2]));		int maidcolor = (Integer) s[3];		//Object texture = s[1];		String textureName = Modchu_CastHelper.String(s[4]);		int handedness = (Integer) s[6];		float modelScale = (Float) s[7];		if (localflag) {			modelData.setCapsValue(modelData.caps_localFlag, true);			modelData.setCapsValue(modelData.caps_skinMode, ModchuModel_IEntityCaps.skinMode_local);			Modchu_Debug.lDebug(""+userName + " : "+"localflag maidcolor = "+maidcolor);		} else {			localBindTextureSetting(modelData, bufferedimage, entity);		}		if (returnflag) {			Modchu_Debug.lDebug(""+userName + " : "+"returnflag");			String s1 = getNewOnlineSkinFlag(modelData) ? "_Player" :"_Biped";			modelInit(entity, modelData, s1);			modelArmorInit(entity, modelData, s1);			modelData.setCapsValue(modelData.caps_initFlag, 2);			return (PFLM_ModelData) checkModelData(modelData);		}		if (isPlayerCheck(modelData, entity)) {			PFLM_ConfigData.textureName = textureName;			PFLM_ConfigData.maidColor = maidcolor;			PFLM_ConfigData.textureArmorName = Modchu_CastHelper.String(modelData.getCapsValue(modelData.caps_textureArmorName));		}		modelData.setCapsValue(modelData.caps_textureName, textureName);		modelData.setCapsValue(modelData.caps_maidColor, maidcolor);		Modchu_Debug.lDebug(""+userName + " : "+"checkSkin textureName = "+textureName);		bufferedimage.flush();		if (textureName != null) modelInit(entity, modelData, textureName);		Modchu_Debug.lDebug(""+userName + " : "+"checkSkin Armor = "+s[2]);		if (modelData.getCapsValue(modelData.caps_textureArmorName) != null) modelArmorInit(entity, modelData, Modchu_CastHelper.String(modelData.getCapsValue(modelData.caps_textureArmorName)));		Modchu_Debug.lDebug(""+userName + " : "+"modelData.textureName = "+textureName);		modelData.setCapsValue(modelData.caps_dominantArm, handedness);		modelData.setCapsValue(modelData.models[0], modelData.caps_dominantArm, handedness);		Modchu_Debug.lDebug(""+userName + " : "+"localflag handedness = "+handedness + " Random=-1 Right=0 Left=1");		modelData.setCapsValue(modelData.caps_modelScale, modelScale);		Modchu_Debug.lDebug(""+userName + " : "+"localflag modelScale = "+modelScale);		if (isPlayerCheck(modelData, entity)) {			PFLM_ConfigData.handednessMode = handedness;			PFLM_ConfigData.modelScale = modelScale;		}		Modchu_Debug.lDebug(""+userName + " : "+"checkSkin ok.return");		modelData.setCapsValue(modelData.caps_initFlag, 2);		return (PFLM_ModelData) checkModelData(modelData);	}	private void localBindTextureSetting(PFLM_ModelData modelData, BufferedImage bufferedimage, Object entity) {		modelData.setCapsValue(modelData.caps_localFlag, false);		Modchu_RenderEngine.instance.bindBufferedImage(getUserName(modelData, entity), bufferedimage);		setResourceLocation(modelData, entity, 0, bufferedimage);	}	@Override	public ModchuModel_ModelDataBase checkModelData(ModchuModel_ModelDataBase modelData) {		//ぬるぽ及び問題が無いかのチェック		int initFlag = modelData.getCapsValueInt(modelData.caps_initFlag);		if (initFlag < 2) {			Modchu_Debug.lDebug("------PFLM_ModelDataMaster init caps_initFlag < 2 return end. initFlag="+initFlag+" ------");			return modelData;		}		return super.checkModelData(modelData);	}	public Object[] checkimage(BufferedImage bufferedimage) {		Object[] object = new Object[8];		// 0 localflag		object[0] = false;		// 1 Texture		object[1] = null;		// 2 modelArmorName		object[2] = "";		// 3 maidcolor		object[3] = 0;		// 4 TextureName		object[4] = "";		// 5 return flag		object[5] = false;		// 6 handedness		object[6] = 0;		// 7 modelScale		object[7] = 0.9375F;		int r = 0;		int g = 0;		int b = 0;		int a = 0;		int checkX = 0;		int checkY = 0;		int[] c1;		boolean checkPointUnder = false;		int imageWidth = bufferedimage.getWidth();		int imageHeight = bufferedimage.getHeight();		do {			checkX = imageWidth - 1;			checkY = 0;			c1 = checkImageColor(bufferedimage, checkX, checkY);			r = c1[0];			g = c1[1];			b = c1[2];			a = c1[3];			checkY = 1;			if (r != 255 | g != 0 | b != 0 | a != 255) {				Modchu_Debug.lDebug((new StringBuilder()).append("checkimage Out r255 g0 b0 a255.x=63,y=0 r=").append(r).append(" g=").append(g).append(" b=").append(b).append(" a=").append(a).toString());				checkPointUnder = true;				checkY = 31;				c1 = checkImageColor(bufferedimage, checkX, checkY);				r = c1[0];				g = c1[1];				b = c1[2];				a = c1[3];				if (r != 255 | g != 0 | b != 0 | a != 255) {					Modchu_Debug.lDebug((new StringBuilder()).append("checkimage Out r255 g0 b0 a255.x=").append(checkX).append(",y=").append(checkY).append(" r=").append(r).append(" g=").append(g).append(" b=").append(b).append(" a=").append(a).toString());					object[5] = true;					break;				}				checkY = 30;			}			c1 = checkImageColor(bufferedimage, checkX, checkY);			r = c1[0];			g = c1[1];			b = c1[2];			a = c1[3];			object[0] = false;			if (r != 255 | g != 255 | b != 0 | a != 255) {				if (r != 255 | g != 0 | b != 255 | a != 255) {					Modchu_Debug.lDebug((new StringBuilder()).append("checkimage Out r255 g0 b255 a255.x = 63,y = 1 r = ").append(r).append(" g = ").append(g).append(" b = ").append(b).append(" a = ").append(a).toString());					object[5] = true;					break;				} else {					Modchu_Debug.lDebug("checkimage localflag = true");					object[0] = true;				}			}			checkX = imageWidth - 2;			checkY = checkPointUnder ? imageHeight - 1 : 0;			c1 = checkImageColor(bufferedimage, checkX, checkY);			r = 255 - c1[0];			g = 255 - c1[1];			b = 255 - c1[2];			a = 255 - c1[3];			Modchu_Debug.mDebug("checkimage r="+r + " g="+g + " b="+b + " a="+a);			break;		} while (true);		if (!(Boolean) object[5]) {			if (g < PFLM_Main.textureList.size()) {				object[2] = PFLM_Main.textureList.get(g);				//Modchu_Debug.mDebug("object[2]="+object[2]);			}			object[3] = r;			if (b < PFLM_Main.textureList.size()) {				object[4] = PFLM_Main.textureList.get(b);				Modchu_Debug.mDebug("checkimage object[4]="+object[4] + " b="+b);				object[1] = ModchuModel_TextureManagerBase.instance.textureManagerGetTexture(PFLM_Main.textureList.get(b), r);			}		}		checkX = imageWidth - 2;		checkY = checkPointUnder ? imageHeight - 2 : 1;		c1 = checkImageColor(bufferedimage, checkX, checkY);		object[6] = c1[0] == 255 ? 0 : c1[0] == 0 ? 1 : -1;		object[7] = (255 - c1[1]) * (0.9375F / 24F);		//Modchu_Debug.mDebug((new StringBuilder()).append("checkimage modelScale color c1[1] = ").append(c1[1]).toString());		b = c1[2];		a = c1[3];		return object;	}	public int[] checkImageColor(BufferedImage bufferedimage, int i, int j) {		Color color = new Color(bufferedimage.getRGB(i, j), true);		int[] i1 = new int[4];		i1[0] = color.getRed();		i1[1] = color.getGreen();		i1[2] = color.getBlue();		i1[3] = color.getAlpha();		return i1;	}	public void sitSleepResetCheck(PFLM_ModelData modelData, Object entity) {		if (Modchu_EntityCapsHelper.getCapsValueBoolean(modelData, modelData.caps_isSitting)				| Modchu_EntityCapsHelper.getCapsValueBoolean(modelData, modelData.caps_isSleeping)				&& entity != null); else return;		//Modchu_Debug.mDebug("PFLM_ModelDataMaster sitSleepResetCheck");		float moveForward = Modchu_AS.getFloat(Modchu_AS.entityLivingBaseMoveForward, entity);		float moveStrafing = Modchu_AS.getFloat(Modchu_AS.entityLivingBaseMoveStrafing, entity);		float f1 = moveForward * moveForward + moveStrafing * moveStrafing;		float f2 = Modchu_AS.getFloat(Modchu_AS.entityLivingBaseLimbSwing, entity) - Modchu_CastHelper.Float(modelData.getCapsValue(modelData.caps_tempLimbSwing));		boolean flag = Modchu_AS.getBoolean(Modchu_AS.entityLivingBaseIsJumping, entity)				| Modchu_AS.getBoolean(Modchu_AS.entityPlayerIsPlayerSleeping, entity);		if (Modchu_EntityCapsHelper.getCapsValueBoolean(modelData, modelData.caps_isSitting)				&& (flag						| f1 > 0.20000000000000001D						| f2 != 0.0F)) {			//Modchu_Debug.mDebug("isSitting 自動OFF flag="+flag+" f1="+f1+" f2="+f2);			modelData.setCapsValueModel(modelData.caps_isRiding, false);			modelData.setCapsValue(modelData.caps_isSitting, false);		}		if (Modchu_EntityCapsHelper.getCapsValueBoolean(modelData, modelData.caps_isSleeping)) {			if (flag						| f1 > 0.20000000000000001F						| f2 != 0.0F) {				//Modchu_Debug.mDebug("isSleeping 自動OFF flag="+flag+" f1="+f1+" f2="+f2);				modelData.setCapsValueModel(modelData.caps_isRiding, false);				modelData.setCapsValue(modelData.caps_isSleeping, false);			}// else {				//Modchu_Debug.mDebug("sitSleepResetCheck isSleeping else flag="+flag+" f1="+f1+" f2="+f2);				//Modchu_Debug.mDebug("sitSleepResetCheck isSleeping else entityLivingBaseIsJumping="+Modchu_AS.getBoolean(Modchu_AS.entityLivingBaseIsJumping, entity));			//}		}		if (Modchu_AS.getBoolean(Modchu_AS.entityIsRiding, entity)				&& (modelData.getCapsValueBoolean(modelData.caps_isSitting)						| modelData.getCapsValueBoolean(modelData.caps_isSleeping))) {			modelData.setCapsValue(modelData.caps_isSitting, false);			modelData.setCapsValue(modelData.caps_isSleeping, false);		}		modelData.setCapsValue(modelData.caps_tempLimbSwing, Modchu_AS.getFloat(Modchu_AS.entityLivingBaseLimbSwing, entity));	}	public void waitModeSetting(PFLM_ModelData modelData, Object entity, float f) {		Object o = modelData != null ? modelData.getCapsValueModel(modelData.caps_onGround) : null;		if (o != null				&& o instanceof float[]); else return;		float[] onGrounds = (float[]) o;		//Modchu_Debug.mDebug("waitModeSetting 1 onGrounds="+onGrounds);		//int i1 = Modchu_EntityCapsHelper.getCapsValueInt(null, modelData, modelData.caps_dominantArm);		//Modchu_Debug.dDebug("waitModeSetting "+onGrounds[i1]+" i1="+i1+" onGrounds[1]="+onGrounds[1]);		if (!Modchu_EntityCapsHelper.getCapsValueBoolean(modelData, modelData.caps_firstPerson)) {			//Modchu_Debug.mDebug("waitModeSetting 2 isPlayerCheck="+(isPlayerCheck(modelData, entity)));			if (PFLM_ConfigData.waitTime == 0					&& isPlayerCheck(modelData, entity)) {				if (!modelData.getCapsValueBoolean(modelData.caps_isWaitFSetFlag)) {					modelData.setCapsValue(modelData.caps_isWaitF, copyf(f));					modelData.setCapsValue(modelData.caps_isWaitFSetFlag, true);				}				if (PFLM_Main.isWait) {					//Modchu_Debug.mDebug("waitModeSetting 3");					//Modchu_Debug.mDebug("waitModeSetting f="+f+" isWaitF="+(modelData.getCapsValueFloat(modelData.caps_isWaitF)));					//Modchu_Debug.mDebug("waitModeSetting isWaitFSetFlag="+(modelData.getCapsValueBoolean(modelData.caps_isWaitFSetFlag)));					//Modchu_Debug.mDebug("waitModeSetting onGrounds[i1] > 0 ? "+(onGrounds[i1] > 0));					//Modchu_Debug.mDebug("waitModeSetting isWait="+(modelData.getCapsValueBoolean(modelData.caps_isWait)));					//Modchu_Debug.mDebug("waitModeSetting isSneak="+(modelData.models[0].isSneak));					if (((f != modelData.getCapsValueFloat(modelData.caps_isWaitF)							&& modelData.getCapsValueBoolean(modelData.caps_isWaitFSetFlag))							| onGrounds[0] > 0							| onGrounds[1] > 0)							| (modelData.getCapsValueBoolean(modelData.caps_isWait)									&& modelData.models[0].isSneak)) {						//Modchu_Debug.mDebug("waitModeSetting 4");						modelData.setCapsValue(modelData.caps_isWait, false);						PFLM_Main.isWait = false;						modelData.setCapsValue(modelData.caps_isWaitTime, 0);						modelData.setCapsValue(modelData.caps_isWaitF, copyf(f));						modelData.setCapsValue(modelData.caps_isWaitFSetFlag, true);					} else {						if ((f != modelData.getCapsValueFloat(modelData.caps_isWaitF)								| onGrounds[0] > 0								| onGrounds[1] > 0)								| (modelData.getCapsValueBoolean(modelData.caps_isWait)										&& modelData.models[0].isSneak)) {							//Modchu_Debug.mDebug("waitModeSetting 5");							modelData.setCapsValue(modelData.caps_isWait, false);							PFLM_Main.isWait = false;							modelData.setCapsValue(modelData.caps_isWaitTime, 0);							modelData.setCapsValue(modelData.caps_isWaitF, copyf(f));						} else {							//Modchu_Debug.mDebug("waitModeSetting 6");							modelData.setCapsValue(modelData.caps_isWait, true);						}					}				}			} else {				int i = Modchu_EntityCapsHelper.getCapsValueBoolean(modelData, modelData.caps_isPlayer) ? PFLM_ConfigData.waitTime : PFLM_ConfigData.othersPlayerWaitTime;				if (!modelData.getCapsValueBoolean(modelData.caps_isWait)						&& !modelData.models[0].isSneak && i > 0) {					modelData.setCapsValue(modelData.caps_isWaitTime, modelData.getCapsValueInt(modelData.caps_isWaitTime) + 1);					if (modelData.getCapsValueInt(modelData.caps_isWaitTime) > i) {						//Modchu_Debug.Debug("isWaitTime > i");						modelData.setCapsValue(modelData.caps_isWait, true);						if (isPlayerCheck(modelData, entity)) PFLM_Main.isWait = true;						modelData.setCapsValue(modelData.caps_isWaitTime, 0);						modelData.setCapsValue(modelData.caps_isWaitF, copyf(f));					}				}				if ((f != modelData.getCapsValueFloat(modelData.caps_isWaitF)						| onGrounds[0] > 0						| onGrounds[1] > 0)						| (modelData.getCapsValueBoolean(modelData.caps_isWait)								&& modelData.models[0].isSneak)) {					//Modchu_Debug.Debug("f != isWaitF");					modelData.setCapsValue(modelData.caps_isWait, false);					if (Modchu_EntityCapsHelper.getCapsValueBoolean(modelData, modelData.caps_isPlayer)) PFLM_Main.isWait = false;					modelData.setCapsValue(modelData.caps_isWaitTime, 0);					modelData.setCapsValue(modelData.caps_isWaitF, copyf(f));				}			}		} else {			if (Modchu_EntityCapsHelper.getCapsValueBoolean(modelData, modelData.caps_isPlayer)) {				if (modelData.getCapsValueBoolean(modelData.caps_isWait)) {					//Modchu_Debug.Debug("firstPerson isWait false");					modelData.setCapsValue(modelData.caps_isWait, false);					if (isPlayerCheck(modelData, entity)) PFLM_Main.isWait = false;					modelData.setCapsValue(modelData.caps_isWaitTime, 0);					modelData.setCapsValue(modelData.caps_isWaitF, copyf(f));					if (PFLM_ConfigData.waitTime == 0) modelData.setCapsValue(modelData.caps_isWaitFSetFlag, true);				} else {					if (PFLM_ConfigData.waitTime == 0							&& !modelData.getCapsValueBoolean(modelData.caps_isWaitFSetFlag)) {						modelData.setCapsValue(modelData.caps_isWaitF, copyf(f));						modelData.setCapsValue(modelData.caps_isWaitFSetFlag, true);					}				}			}		}	}	public void skinMode_FalseSetting(Object entity, PFLM_ModelData modelData) {		modelData.setCapsValue(modelData.caps_skinMode, ModchuModel_IEntityCaps.skinMode_online);	}	public void skinMode_PlayerSetting(Object entity, PFLM_ModelData modelData) {		Object thePlayer = Modchu_AS.get(Modchu_AS.minecraftThePlayer);		PFLM_ModelData modelData2 = (PFLM_ModelData) getPlayerData(thePlayer);		if (modelData2 != null) {			modelData.setCapsValue(modelData.caps_skinMode, ModchuModel_IEntityCaps.skinMode_Player);			modelData.setCapsValue(modelData.caps_dominantArm, playerHandednessSetting());			modelData.setCapsValue(modelData.caps_modelScale, PFLM_ConfigData.modelScale);			modelData.setCapsValue(modelData.caps_textureName, modelData2.getCapsValue(modelData.caps_textureName));			modelData.setCapsValue(modelData.caps_textureArmorName, modelData2.getCapsValue(modelData.caps_textureArmorName));			modelData.setCapsValue(modelData.caps_maidColor, modelData2.getCapsValueInt(modelData.caps_maidColor));			if (modelData2.getCapsValueBoolean(modelData.caps_freeVariable, "skinChar")) {				modelData.setCapsValue(modelData.caps_freeVariable, "skinChar", true);				textureBipedDefaultSetting(modelData, getNewOnlineSkinFlag(modelData));			} else {				modelData.setCapsValue(modelData.caps_freeVariable, "skinChar", false);			}			modelInit(entity, modelData, Modchu_CastHelper.String(modelData.getCapsValue(modelData.caps_textureName)));			modelArmorInit(entity, modelData, Modchu_CastHelper.String(modelData.getCapsValue(modelData.caps_textureArmorName)));		}	}	public void skinMode_PlayerOnlineSetting(Object entity, PFLM_ModelData modelData) {		modelData.setCapsValue(modelData.caps_skinMode, ModchuModel_IEntityCaps.skinMode_PlayerOnline);		modelData.setCapsValue(modelData.caps_dominantArm, playerHandednessSetting());		modelData.setCapsValue(modelData.caps_modelScale, PFLM_ConfigData.modelScale);	}	public void skinMode_PlayerOfflineSetting(Object entityplayer, PFLM_ModelData modelData) {/*		if (PFLM_ConfigData.textureName == null			| PFLM_ConfigData.textureName.isEmpty()) PFLM_ConfigData.textureName = "_Biped";		if (PFLM_ConfigData.textureArmorName == null			| PFLM_ConfigData.textureArmorName.isEmpty()) PFLM_ConfigData.textureArmorName = "_Biped";*/		modelData.setCapsValue(modelData.caps_maidColor, PFLM_ConfigData.maidColor);		//setResourceLocation(modelData, entityplayer, 0, Modchu_Main.textureManagerGetTexture(PFLM_ConfigData.textureName, modelData.getCapsValueInt(modelData.caps_maidColor)));		modelData.setCapsValue(modelData.caps_skinMode, ModchuModel_IEntityCaps.skinMode_PlayerOffline);		modelData.setCapsValue(modelData.caps_dominantArm, playerHandednessSetting());		modelData.setCapsValue(modelData.caps_modelScale, PFLM_ConfigData.modelScale);		modelData.setCapsValue(modelData.caps_freeVariable, "skinChar", false);		String s1 = PFLM_ConfigData.textureName;		modelInit(entityplayer, modelData, s1);		modelData.setCapsValue(modelData.caps_textureName, s1);		s1 = PFLM_ConfigData.textureArmorName;		modelData.setCapsValue(modelData.caps_textureArmorName, PFLM_ConfigData.textureArmorName);		modelArmorInit(entityplayer, modelData, s1);	}	public void skinMode_RandomSetting(Object entity, PFLM_ModelData modelData) {		String s3 = null;		Object s4 = null;		int i = 0;		for (int i1 = 0; s4 == null && i1 < 50; i1++) {			i = rnd.nextInt(16);			int j = 0;			int size = ModchuModel_TextureManagerBase.instance.textures.size();			if (size > 0) {				j = rnd.nextInt(size);				s3 = ModchuModel_TextureManagerBase.instance.getPackege(i, j);			} else {				s3 = ModchuModel_TextureManagerBase.instance.textureNameCheck(null);			}			modelData.setCapsValue(modelData.caps_maidColor, i);			s4 = ModchuModel_TextureManagerBase.instance.textureManagerGetTexture(s3, i);			if (i1 == 49) return;		}		Modchu_Debug.lDebug("Random modelPackege="+s3);		modelData.setCapsValue(modelData.caps_skinMode, ModchuModel_IEntityCaps.skinMode_Random);		//setResourceLocation(modelData, entityplayer, 0, s4);		//Modchu_Debug.mDebug("Random s4="+s4);		String s1 = ModchuModel_TextureManagerBase.instance.getArmorName(s3);		modelData.setCapsValue(modelData.caps_textureName, s3);		modelData.setCapsValue(modelData.caps_textureArmorName, s1);		modelData.setCapsValue(modelData.caps_maidColor, i);		modelData.setCapsValue(modelData.caps_freeVariable, "skinChar", false);		modelInit(entity, modelData, s3);		modelArmorInit(entity, modelData, s1);	}	public void setHandedness(Object entity, int i) {		PFLM_ModelData modelData = (PFLM_ModelData) getPlayerData(entity);		if (i == -1) i = rnd.nextInt(2);		modelData.setCapsValue(modelData.caps_dominantArm, i);		modelData.setCapsValueModel(modelData.caps_dominantArm, i);		if (isPlayerCheck(modelData, entity)) {			PFLM_Main.setFlipHorizontal(i == 0 ? false : true);			PFLM_Main.setLeftHandedness(i == 0 ? false : true);		}	}	public boolean getResetFlag() {		return resetFlag;	}	public void setResetFlag(boolean b) {		resetFlag = b;	}	public float copyf(float f) {		return f;	}	@Override	public void clearDataMap() {		super.clearDataMap();		sendIDAllFlag = true;	}}